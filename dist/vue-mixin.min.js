"use strict";function install(t){install.installed||(install.installed=!0,_Vue=t)}function vueMixinFetchDetail(t){if("string"==typeof t.key){var e=t.key.split("."),n=slicedToArray(e,2),r=n[0],i=n[1];t.detailName=r,t.keyName=i,utils.isObject(t.mixins)?t.mixins=[t.mixins]:utils.isArray(t.mixins)||(t.mixins=[]);var a=t.model();return{name:"fetchDetail",store:a,install:function(e){function n(e){for(var n=r.list,i=r.list.length,a=0;a<i;a++)if(String(n[a][t.keyName])===String(e))return a;return-1}var r=e.store.fetchList;return this.listUnwatch=e.vm.$watch("store.fetchList.list",function(e){var r=n(a[t.detailName][t.keyName]);if(r<0)return!1;var i=e[r];Object.keys(a[t.detailName]).forEach(function(e){Object.prototype.hasOwnProperty.call(i,e)&&(a[t.detailName][e]=i[e])})},{deep:!0}),this.detailUnwatch=e.vm.$watch("store.fetchDetail."+t.detailName,function(e){var i=n(a[t.detailName][t.keyName]);if(i<0)return!1;Object.keys(r.list[i]).forEach(function(t){r.list[i][t]=e[t]})},{deep:!0}),{mixins:t.mixins,props:[t.keyName],beforeRouteEnter:function(e,i,o){if(String(e.params[t.keyName])!==String(a[t.detailName][t.keyName])){var s=n(e.params[t.keyName]);Object.assign(a,t.model(),defineProperty({},t.detailName,r.list[s]||{}))}o()},computed:_extends({},utils.createComputed(a),{$fetchDetail:function(){function e(){if(n[t.keyName])return t.fetch.call(n).then(function(t){Object.assign(a,t)})}var n=this;return e}}),created:function(){this.$fetchDetail()},watch:defineProperty({},t.keyName,function(){this.$fetchDetail()})}},destroyed:function(){this.listUnwatch(),this.detailUnwatch()}}}}function vueMixinFetchList(t){function e(t){var e=[];return Object.keys(t).forEach(function(n){return e.push(n+"="+t[n])}),e.join("&")}function n(){var e=t.model();Object.assign(r,e)}var r=t.model();return{name:"fetchList",store:r,install:function(i){var a="";return{beforeRouteEnter:function(t,r,i){e(t.query)!==a&&n(),i()},computed:_extends({},utils.createComputed(r),{$fetchList:function(){function i(){var n=e(o.$route.query);return t.fetch.call(o).then(function(t){if(n!==e(o.$route.query))return!1;Object.assign(r,t),a=n})}var o=this;return i.init=function(){n.apply(o,arguments)},i.search=function(){for(var e={},n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];event===r[0]&&(r[0]={}),utils.isObject(r[0])?e=r[0]:"string"==typeof r[0]&&(e[r[0]]=r[1]),e=Object.assign({},o.$route.query,defineProperty({},t.pagekey,1),o[t.queryKey],e),o.$router.push(_extends({},this.$route,{query:e}))},i.syncQuery=function(){var e=o[t.queryKey];utils.isObject(e)&&Object.keys(e).forEach(function(t){Object.prototype.hasOwnProperty.call(o.$route.query,t)&&(e[t]=o.$route.query[t])})},i}}),created:function(){this.$fetchList.syncQuery(),this.$fetchList()},watch:{"$route.query":function(t,n){if(this.$fetchList.syncQuery(),e(t)===e(n))return!1;this.$fetchList()}}}},destroyed:function(t){}}}function vueMixinStore(t){var e={},n={},r={base:[],update:!0,fetch:function(){return Promise.resolve({})}};return Object.keys(t).forEach(function(e){var i=t[e];utils.isObject(i)?n[e]=Object.assign({},r,i):"function"==typeof i&&(n[e]=Object.assign({},r,{fetch:i}))}),{name:"store",store:e,install:function(t){return{created:function(){function t(t){t.forEach(function(t){a[t]=n[t]})}function r(t){var r=this,i=[],a=Object.keys(t),o=function(t,n){Object.defineProperty(n,"_ok_",{value:!0,enumerable:!1,configurable:!1,writable:!0}),r.$data[t]=e[t]=n};return a.forEach(function(e){var n=t[e],a=n.fetch.call(r).then(function(t){return o(e,t),t});i.push(a)}),Promise.all(i).then(function(t){Object.keys(n).forEach(function(e){var i=[],s=n[e];if(!s.base.length)return!1;for(var u=0;u<s.base.length;u++){var c=a.indexOf(s.base[u]);if(!(c>-1))break;i.push(t[c])}i.length===s.base.length&&o(e,s.fetch.apply(r,i))})})}var i=this,a={};Object.keys(n).forEach(function(r){if(!utils.isHas(i.$data,r))return!1;utils.isHas(e,r)?i.$data[r]=e[r]:_Vue.set(e,r,i.$data[r]);var o=n[r],s=e[r];if(!o.update&&s._ok_)return!1;0===o.base.length?a[r]=o:t(o.base)}),r.call(this,a)},computed:{$vueMixinStore:function(){return e}}}}}}Object.defineProperty(exports,"__esModule",{value:!0});var _Vue=void 0,utils={isObject:function(t){return"[object Object]"===Object.prototype.toString.call(t)},isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},isHas:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},createComputed:function(t){var e={};return Object.keys(t).forEach(function(n){e[n]={get:function(){return t[n]},set:function(e){t[n]=e}}}),e}},classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),defineProperty=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},_extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},slicedToArray=function(){function t(t,e){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(t){i=!0,a=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),VueMixin$1=function(){function t(e){var n=this;classCallCheck(this,t),this.mixins={},this.store={},this.plugins=e.plugins||[],this.vm=new _Vue({data:{store:this.store}}),this.plugins.forEach(function(t){n.mixins[t.name]=Object.assign(t.install(n)),utils.isObject(t.store)&&n.createStore(t.name,t.store)})}return createClass(t,[{key:"createStore",value:function(t,e){_Vue.set(this.store,t,e)}},{key:"destroyed",value:function(){this.plugins.forEach(function(t){"function"==typeof t.destroyed&&t.destroyed()}),this.vm.destroyed()}}]),t}();VueMixin$1.install=install,exports.default=VueMixin$1,exports.vueMixinFetchDetail=vueMixinFetchDetail,exports.vueMixinFetchList=vueMixinFetchList,exports.vueMixinStore=vueMixinStore;
//# sourceMappingURL=vue-mixin.min.js.map
