"use strict";function install(t){install.installed||(install.installed=!0,_Vue=t)}function vueMixinFetchDetail(t){void 0===t.key&&(t.key="id");var e={detail:t.model()};return{name:"fetchDetail",store:e,install:function(n){function r(e){for(var n=i.list,r=i.list.length,o=0;o<r;o++)if(String(n[o][t.key])===String(e))return o;return-1}var i=n.store.fetchList;return this.listUnwatch=n.vm.$watch("store.fetchList.list",function(n){var i=r(e.detail[t.key]);if(i<0)return!1;var o=n[i];Object.keys(e.detail).forEach(function(t){Object.prototype.hasOwnProperty.call(o,t)&&(e.detail[t]=o[t])})},{deep:!0}),this.detailUnwatch=n.vm.$watch("store.fetchDetail.detail",function(n){var o=r(e.detail[t.key]);if(o<0)return!1;Object.keys(i.list[o]).forEach(function(t){i.list[o][t]=n[t]})},{deep:!0}),{props:[t.key],beforeRouteEnter:function(n,o,c){if(String(n.params[t.key])!==String(e.detail[t.key])){var u=r(n.params[t.key]);Object.assign(e.detail,t.model(),i.list[u]||{})}c()},computed:_extends({},utils.createComputed(e),{$fetchDetail:function(){function n(){if(r[t.key])return t.fetch.call(r).then(function(t){return e.detail=t})}var r=this;return n}}),created:function(){this.$fetchDetail()},watch:defineProperty({},t.key,function(){this.$fetchDetail()})}},destroyed:function(){this.listUnwatch(),this.detailUnwatch()}}}function vueMixinFetchList(t){function e(t){var e=[];return Object.keys(t).forEach(function(n){return e.push(n+"="+t[n])}),e.join("&")}function n(){var e=t.model();Object.assign(r,e)}var r=t.model();return{name:"fetchList",store:r,install:function(i){var o="";return{beforeRouteEnter:function(t,r,i){e(t.query)!==o&&n(),i()},computed:_extends({},utils.createComputed(r),{$fetchList:function(){function i(){var n=e(c.$route.query);return t.fetch.call(c).then(function(i){if(n!==e(c.$route.query))return!1;Object.assign(r,t.model(),i),o=n})}var c=this;return i.init=function(){n.apply(c,arguments)},i.search=function(){for(var e={},n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];event===r[0]&&(r[0]={}),utils.isObject(r[0])?e=r[0]:"string"==typeof r[0]&&(e[r[0]]=r[1]),e=Object.assign({},c.$route.query,defineProperty({},t.pagekey,1),c[t.queryKey],e),c.$router.push(_extends({},this.$route,{query:e}))},i.syncQuery=function(){var e=c[t.queryKey];utils.isObject(e)&&Object.keys(e).forEach(function(t){Object.prototype.hasOwnProperty.call(c.$route.query,t)&&(e[t]=c.$route.query[t])})},i}}),created:function(){this.$fetchList.syncQuery(),this.$fetchList()},watch:{"$route.query":function(t,n){if(this.$fetchList.syncQuery(),e(t)===e(n))return!1;this.$fetchList()}}}},destroyed:function(t){}}}function vueMixinStore(t){var e={},n={},r={base:[],update:!0,fetch:function(){return Promise.resolve({})}};return Object.keys(t).forEach(function(e){var i=t[e];utils.isObject(i)?n[e]=Object.assign({},r,i):"function"==typeof i&&(n[e]=Object.assign({},r,{fetch:i}))}),{name:"store",store:e,install:function(t){return{created:function(){function t(t){t.forEach(function(t){o[t]=n[t]})}function r(t){var r=this,i=[],o=Object.keys(t),c=function(t,n){Object.defineProperty(n,"_ok_",{value:!0,enumerable:!1,configurable:!1,writable:!0}),r.$data[t]=e[t]=n};return o.forEach(function(e){var n=t[e],o=n.fetch.call(r).then(function(t){return c(e,t),t});i.push(o)}),Promise.all(i).then(function(t){Object.keys(n).forEach(function(e){var i=[],u=n[e];if(!u.base.length)return!1;for(var a=0;a<u.base.length;a++){var s=o.indexOf(u.base[a]);if(!(s>-1))break;i.push(t[s])}i.length===u.base.length&&c(e,u.fetch.apply(r,i))})})}var i=this,o={};Object.keys(n).forEach(function(r){if(!utils.isHas(i.$data,r))return!1;utils.isHas(e,r)?i.$data[r]=e[r]:_Vue.set(e,r,i.$data[r]);var c=n[r],u=e[r];if(!c.update&&u._ok_)return!1;0===c.base.length?o[r]=c:t(c.base)}),r.call(this,o)},computed:{$vueMixinStore:function(){return e}}}}}}Object.defineProperty(exports,"__esModule",{value:!0});var _Vue=void 0,utils={isObject:function(t){return"[object Object]"===Object.prototype.toString.call(t)},isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},isHas:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},createComputed:function(t){var e={};return Object.keys(t).forEach(function(n){e[n]={get:function(){return t[n]},set:function(e){t[n]=e}}}),e}},classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),defineProperty=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},_extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},VueMixin$1=function(){function t(e){var n=this;classCallCheck(this,t),this.mixins={},this.store={},this.plugins=e.plugins||[],this.vm=new _Vue({data:{store:this.store}}),this.plugins.forEach(function(t){n.mixins[t.name]=Object.assign(t.install(n)),utils.isObject(t.store)&&n.createStore(t.name,t.store)})}return createClass(t,[{key:"createStore",value:function(t,e){_Vue.set(this.store,t,e)}},{key:"destroyed",value:function(){this.plugins.forEach(function(t){"function"==typeof t.destroyed&&t.destroyed()}),this.vm.destroyed()}}]),t}();VueMixin$1.install=install,exports.default=VueMixin$1,exports.vueMixinFetchDetail=vueMixinFetchDetail,exports.vueMixinFetchList=vueMixinFetchList,exports.vueMixinStore=vueMixinStore;
//# sourceMappingURL=vue-mixin.min.js.map
